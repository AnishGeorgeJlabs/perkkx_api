// Generated by CoffeeScript 1.9.3
(function() {
  angular.module('Wadi.form', []).controller('FormCtrl', function($scope, $state, $log, $http) {
    var cleanObj, configureForm;
    $scope.checkLogin = function() {
      $log.info("Checking login status at FormCtrl");
      if (!$scope.$parent.checkLogin()) {
        return $state.go('login');
      }
    };
    $scope.checkLogin();
    $http.get('http://45.55.72.208/wadi/interface/form').success(function(data) {
      return configureForm(data);
    });
    $scope.multi = {};
    $scope.single = {};
    $scope.range = {};
    $scope.selectedMulti = {};
    $scope.selectedSingle = {};
    $scope.selectedRange = {};
    configureForm = function(mainData) {
      var data, i, len, results;
      results = [];
      for (i = 0, len = mainData.length; i < len; i++) {
        data = mainData[i];
        if (data.type === 'single') {
          $scope.single[data.operation] = {
            name: data.pretty,
            values: data.values
          };
          results.push($scope.selectedSingle[data.operation] = '');
        } else if (data.type === 'multi') {
          $scope.multi[data.operation] = {
            name: data.pretty,
            values: data.values
          };
          results.push($scope.selectedMulti[data.operation] = []);
        } else if (data.type === 'range') {
          results.push($scope.range[data.operation] = {
            name: data.pretty
          });
        } else {
          results.push(void 0);
        }
      }
      return results;
    };
    cleanObj = function(obj) {
      return _.pick(obj, function(val, key, o) {
        return val.length > 0;
      });
    };
    $scope.campaign = {
      text: {
        arabic: '',
        english: ''
      },
      date: ''
    };
    return $scope.submit = function() {
      var dt, resM, resR, resS, result, target_config;
      resM = cleanObj($scope.selectedMulti);
      resS = cleanObj($scope.selectedSingle);
      resR = cleanObj($scope.selectedRange);
      target_config = _.extend({}, resS, resM, resR);
      dt = moment($scope.campaign.date).format("MM/DD/YYYY HH:mm").split(" ");
      result = {
        target_config: target_config,
        campaign_config: {
          text: $scope.campaign.text,
          date: dt[0],
          time: dt[1]
        }
      };
      $log.info("Final submission: " + JSON.stringify(result));
      return $http.post('http://45.55.72.208/wadi/interface/post', result).success(function(res) {
        return $log.info("Got result: " + JSON.stringify(res));
      });
    };
  });

}).call(this);

//# sourceMappingURL=app_form.js.map
